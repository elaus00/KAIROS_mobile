# KAIROS — 기능명세서

> **Version**: 2.1
**작성일**: 2026-02-06
**기준**: PRD v10.0, 데이터 모델 명세서 v2.0
> 

---

## 0. 상태 모델 및 공통 정책

### 0.1 분류 상태 모델

캡처된 원본 입력(raw input)은 다음 상태를 거쳐 분류된다.

**최상위 분류 (classified_type):**

```
TEMP (초기/폴백)
  → AI 분류 성공 → TODO | SCHEDULE | NOTES
  → AI 분류 실패/오프라인 → TEMP 유지 (재분류 대기)

TODO ↔ SCHEDULE ↔ NOTES (사용자 수동 수정)
```

| 상태 | 설명 | 진입 조건 |
| --- | --- | --- |
| TEMP | 미분류 상태. 임시 저장, 오프라인, AI 분류 실패 시 | 캡처 직후 기본 상태 |
| TODO | 할 일 | AI 분류 또는 사용자 수정 |
| SCHEDULE | 일정 | AI 분류 또는 사용자 수정 |
| NOTES | 노트 (아이디어 포함) | AI 분류 또는 사용자 수정 |

**NOTES 서브 분류 (note_sub_type):**

NOTES로 분류된 항목은 추가로 서브 분류가 적용된다.

| 서브 분류 | 설명 | 비고 |
| --- | --- | --- |
| INBOX | 미분류 노트. 기본 배치 | 노트의 기본 서브 분류 |
| IDEA | 아이디어 | 기존 최상위 분류에서 NOTES 하위로 이동 |
| BOOKMARK | 웹 링크, 외부 인텐트를 통해 전달된 URL | URL 감지 시 자동 설정 |
| USER_FOLDER | 사용자 생성 폴더에 배치된 노트 | 사용자가 폴더로 이동 시 |

```
NOTES 분류 시:
  AI 판단 → IDEA (아이디어성 내용)
  AI 판단 → BOOKMARK (URL 포함)
  AI 판단 → INBOX (기본)
  
사용자 수동 이동 → USER_FOLDER (folder_id 설정)
```

**사용자 분류 수정 UI 옵션:**

분류 수정 드롭다운에는 다음 4개 옵션이 표시된다.

| UI 표시 | 내부 매핑 |
| --- | --- |
| 일정 | classified_type = SCHEDULE |
| 할 일 | classified_type = TODO |
| 노트 | classified_type = NOTES, note_sub_type = INBOX |
| 아이디어 | classified_type = NOTES, note_sub_type = IDEA |

### 0.2 삭제 상태 모델

모든 캡처 항목의 삭제는 안전망을 거친다.

**Phase 1:**

```
Active (기본)
  → 사용자 삭제 동작 → Soft Delete (is_deleted=true, deleted_at=now)
    → UI에서 즉시 제거 + Snackbar 3초 표시
      → "실행 취소" 탭 → Active 복원 (is_deleted=false)
      → Snackbar 만료 → Hard Delete (DB에서 완전 삭제)
```

| 단계 | 기간 | 사용자 복원 | 데이터 상태 |
| --- | --- | --- | --- |
| Soft Delete | 3초 (Snackbar) | Snackbar "실행 취소" 탭 | DB 존재, UI 미표시 |
| Hard Delete | 영구 | 불가 | DB 완전 삭제 + 파생 엔티티 삭제 |

**Phase 2a (휴지통 도입):**

```
Active (기본)
  → 사용자 삭제 동작 → Soft Delete (is_deleted=true, deleted_at=now)
    → UI에서 즉시 제거 + Snackbar 3초 표시
      → "실행 취소" 탭 → Active 복원 (is_deleted=false)
      → Snackbar 만료 → Trash 이동 (is_trashed=true, trashed_at=now)
        → 30일 이내 → 사용자 복원 가능 (Active 복원)
        → 30일 경과 → Hard Delete (DB에서 완전 삭제)
```

| 단계 | 기간 | 사용자 복원 | 데이터 상태 |
| --- | --- | --- | --- |
| Soft Delete | 3초 (Snackbar) | Snackbar "실행 취소" 탭 | DB 존재, UI 미표시 |
| Trash | 30일 | 휴지통에서 복원 버튼 | DB 존재, 휴지통에서만 접근 |
| Hard Delete | 영구 | 불가 | DB 완전 삭제 + 파생 엔티티 삭제 |

**파생 엔티티 처리:** Hard Delete 시 Capture + Todo/Schedule/Note + Tags + Entities 모두 삭제. Schedule이 SYNCED 상태이면 Google Calendar 이벤트 삭제 요청 큐잉.

### 0.3 캘린더 동기화 상태 모델

Google Calendar 연동 시 일정의 동기화 상태.

```
NOT_LINKED (Phase 1 기본값)
  → Google 연동 + confidence=HIGH + 완전자동모드 → SYNCED
  → Google 연동 + 그 외 → SUGGESTION_PENDING

SUGGESTION_PENDING
  → 사용자 승인 → SYNCED
  → 사용자 거부 → REJECTED
  → 일정 날짜 경과 → EXPIRED

SYNCED
  → 사용자 실행 취소 → NOT_LINKED (Google 이벤트 삭제)
  → 분류 변경 → NOT_LINKED (Google 이벤트 삭제 + Schedule 삭제)
  → Google API 오류 → SYNC_FAILED

SYNC_FAILED
  → 자동 재시도 성공 → SYNCED
  → 재시도 3회 실패 → SYNC_FAILED (사용자 알림)

REJECTED (최종 상태)
EXPIRED (최종 상태)
```

### 0.4 할 일 상태 모델

```
ACTIVE (is_completed=false)
  → 사용자 체크 → COMPLETED (is_completed=true, completed_at 기록)
  → 분류 변경 → DELETED (Todo 레코드 삭제)
  → 캡처 삭제 → 삭제 상태 모델 따름 (0.2)

COMPLETED
  → 사용자 체크 해제 → ACTIVE (completed_at 초기화)
```

### 0.5 재시도/큐잉 정책

모든 서버 요청은 SyncQueue를 통해 관리된다.

**큐잉 대상 작업:**

| 작업 | 트리거 | 재시도 정책 |
| --- | --- | --- |
| CLASSIFY | 캡처 생성 시 | 최대 3회, 지수 백오프 (5s → 15s → 45s) |
| RECLASSIFY | Temp 재분류 주기 작업 | 최대 3회, 실패 시 다음 주기로 이월 |
| CALENDAR_CREATE | 일정 동기화 시 | 최대 3회, 실패 시 SYNC_FAILED + 사용자 알림 |
| CALENDAR_DELETE | 일정 삭제/분류 변경 시 | 최대 5회, 지수 백오프 |
| ANALYTICS_BATCH | 분석 이벤트 전송 | 최대 3회, 실패 시 다음 배치에 포함 |

**큐잉 동작:**

| 조건 | 동작 |
| --- | --- |
| 네트워크 가용 | 즉시 실행 |
| 네트워크 불가 | 큐에 PENDING 상태로 저장 |
| 네트워크 복구 시 | PENDING 작업 순차 실행 |
| 재시도 초과 시 | status=FAILED, 사용자 알림 (해당 시) |

**큐 상태:**

```
PENDING → PROCESSING → COMPLETED
                     → FAILED (재시도 초과)
PENDING → PROCESSING → PENDING (재시도 대기, next_retry_at 설정)
```

**배치 전송 규칙 (Analytics):**

| 조건 | 동작 |
| --- | --- |
| 이벤트 50건 축적 | 즉시 전송 |
| 마지막 전송 후 1시간 경과 | 잔여 이벤트 전송 |
| 네트워크 복구 시 | 미전송 이벤트 전송 |

---

## 1. 캡처 (Capture)

### 1.1 텍스트 캡처 (Phase 1)

**트리거:** 사용자가 입력창에 텍스트 입력 후 전송 버튼 탭

**동작 흐름:**

| 단계 | 동작 | 실패 시 |
| --- | --- | --- |
| 1 | 입력 텍스트 검증 (빈 문자열 제외) | 전송 버튼 비활성 유지 |
| 2 | Capture 레코드 로컬 저장 (classified_type=TEMP) | — (Room 실패는 앱 오류) |
| 3 | 입력창 초기화 + 완료 피드백 표시 | — |
| 4 | SyncQueue에 CLASSIFY 작업 추가 | 큐잉 실패 시 TEMP 유지 |
| 5 | 네트워크 가용 시 서버 분류 요청 | 오프라인이면 큐 대기 |
| 6 | 분류 결과 수신 → Capture 업데이트 + 파생 엔티티 생성 | 타임아웃(5초)/에러 시 TEMP 유지 |
| 7 | AI 분류 현황 시트에 신규 항목 추가 | — |

**입력 규칙:**

| 규칙 | 설명 |
| --- | --- |
| 최소 길이 | 1자 이상 (공백만은 불가) |
| 최대 길이 | 5,000자 (초과 시 입력 차단 + 카운터 표시) |
| 줄바꿈 | 허용. 여러 줄 입력 시 입력창 높이 최대 4줄까지 확장 |
| 전송 버튼 | 텍스트가 1자 이상일 때만 활성화 |

### 1.2 임시 저장 (Phase 1)

**트리거:** 사용자가 입력창에 텍스트 입력 중 앱 이탈 (홈 버튼, 태스크 전환, 앱 종료)

**동작:**

| 이벤트 | 동작 |
| --- | --- |
| onPause | 입력창 텍스트 + 첨부 이미지 경로를 EncryptedSharedPreferences에 저장 |
| onResume | EncryptedSharedPreferences에서 텍스트 및 이미지 경로 복원 → 입력창에 표시 |
| 전송 완료 | EncryptedSharedPreferences 초기화 |

**저장 대상:** 텍스트 + 이미지 첨부 경로 (Phase 2a부터).

**보안:** EncryptedSharedPreferences를 사용하여 임시 저장 데이터를 암호화 저장한다.

### 1.3 이미지 첨부 (Phase 2a)

**트리거:** 캡처 입력 중 이미지 첨부 아이콘 탭

**이미지 소스:**

| 소스 | 동작 |
| --- | --- |
| 갤러리 | 갤러리 인텐트 → 이미지 선택 → 로컬 복사 |
| 카메라 | 카메라 인텐트 → 즉석 촬영 → 로컬 복사 |

**선택 UI:** 이미지 첨부 아이콘 탭 시 "갤러리에서 선택" / "카메라 촬영" 선택지를 바텀시트로 표시.

**동작:** 이미지 선택/촬영 → 로컬 복사 → image_uri에 경로 저장. 텍스트 없이 이미지만 전송 시 classified_type=TEMP.

### 1.4 삭제 및 실행 취소 (Phase 1)

**삭제 트리거:** 리스트에서 스와이프 삭제 또는 상세 보기에서 삭제 버튼

**Phase 1 동작:**

| 단계 | 동작 |
| --- | --- |
| 1 | Capture.is_deleted = true, deleted_at = now |
| 2 | UI에서 즉시 제거 |
| 3 | Snackbar 표시: "삭제됨 · 실행 취소" (3초) |
| 4a | "실행 취소" 탭 → is_deleted = false, deleted_at = null → UI 복원 |
| 4b | Snackbar 만료 → Hard Delete (Capture + 모든 파생 엔티티) |

**Phase 2a 동작 (휴지통 도입):**

| 단계 | 동작 |
| --- | --- |
| 1 | Capture.is_deleted = true, deleted_at = now |
| 2 | UI에서 즉시 제거 |
| 3 | Snackbar 표시: "삭제됨 · 실행 취소" (3초) |
| 4a | "실행 취소" 탭 → is_deleted = false, deleted_at = null → UI 복원 |
| 4b | Snackbar 만료 → 휴지통 이동 (is_trashed=true, trashed_at=now) |
| 5 | 휴지통에서 30일 경과 → Hard Delete (Capture + 모든 파생 엔티티) |

**파생 엔티티 처리:** Hard Delete 시 Todo/Schedule/Note 레코드도 함께 삭제. Schedule이 SYNCED 상태이면 Google Calendar 이벤트 삭제 요청 큐잉.

### 1.5 다중 의도 분리 (Phase 2b)

**트리거:** AI 분류 시 캡처 텍스트에 여러 독립적 의도가 포함된 것으로 판단된 경우

**판단 기준:** AI가 텍스트 내에 2개 이상의 명확히 분리 가능한 행동 항목(할 일, 일정 등)이 포함되어 있다고 판단한 경우.

**동작:**

| 단계 | 동작 |
| --- | --- |
| 1 | AI가 원문에서 N개 의도 식별 |
| 2 | 원본 Capture는 보존 (original_text 유지) |
| 3 | 각 의도별로 개별 Capture 생성 (source=SPLIT, parent_capture_id 참조) |
| 4 | 각 개별 Capture에 대해 독립적 분류 적용 |
| 5 | AI 분류 현황 시트에 분리된 항목들이 표시됨 |

**예시:**

| 원문 | 분리 결과 |
| --- | --- |
| "회의 끝나고 보고서 쓰고 저녁 예약" | ① "보고서 작성" (TODO) ② "저녁 예약" (TODO 또는 SCHEDULE) |
| "금요일 미팅 후 카페 알아보기" | ① "금요일 미팅" (SCHEDULE) ② "카페 알아보기" (TODO) |

**제약:** 분리는 AI 판단이므로 오분류 가능. 사용자는 AI 분류 현황 시트에서 분리 결과를 확인하고 수정할 수 있다.

---

## 2. AI 자동 분류

### 2.1 분류 요청 및 응답 (Phase 1)

**요청:** 서버 POST /api/v1/classify에 텍스트 전송

**응답 처리:**

| 응답 필드 | 로컬 처리 |
| --- | --- |
| classified_type | Capture.classified_type 업데이트 (TODO / SCHEDULE / NOTES) |
| note_sub_type | NOTES인 경우 서브 분류 (INBOX / IDEA / BOOKMARK) |
| confidence | Capture.confidence 업데이트 |
| ai_title | Capture.ai_title 업데이트 |
| tags[] | Tag 레코드 생성 (중복 시 기존 참조) + CaptureTag 연결 |
| entities[] | Entity 레코드 생성 |
| schedule_info | Schedule 파생 엔티티 생성 시 활용 |
| todo_info | Todo 파생 엔티티 생성 시 활용 |
| split_items[] | 다중 의도 분리 결과 (1.5 참조) |

**분류 완료 후:** classified_type에 따라 파생 엔티티 생성.

| classified_type | 파생 엔티티 | 추가 처리 |
| --- | --- | --- |
| TODO | Todo 레코드 생성 | deadline, tags 설정 |
| SCHEDULE | Schedule 레코드 생성 | start_time, location 설정 |
| NOTES | Note 레코드 생성 | note_sub_type에 따라 folder_id 설정 |
| TEMP | 파생 엔티티 없음 | 재분류 대기 |

### 2.2 AI 제목 생성 규칙 (Phase 1)

AI는 분류 시 원문 기반 요약 제목을 함께 생성한다.

| 원문 상태 | 제목 생성 규칙 | 예시 |
| --- | --- | --- |
| 짧고 명확 (≤30자, 단일 의도) | 원문을 그대로 제목으로 사용 | "우유 사기" → "우유 사기" |
| 길지만 단일 의도 | 핵심 의도 요약 (≤30자) | "금요일까지 보고서 제출해야 하는데..." → "보고서 제출 (금요일)" |
| 대화체/비정형 | 구조화된 요약 | "ㅋㅋ 금요일 7시 강남역 ㅇㅋ?" → "금요일 19시 강남역 모임" |
| 여러 의도 혼합 | 다중 의도 분리 적용 (1.5 참조) | 각 분리된 항목에 개별 제목 생성 |

**원본 보존:** ai_title이 생성되어도 original_text는 항상 보존. 상세 보기에서 원본 확인 가능.

### 2.3 비기록성 입력 처리 (Phase 1)

질문형/대화형 입력은 행동 항목으로 환원한다.

| 입력 패턴 | classified_type | ai_title | todo deadline | 태그 |
| --- | --- | --- | --- | --- |
| 정보 확인형 ("오늘 날씨 뭐야?") | TODO | "날씨 확인" | 오늘 | AI에게 물어볼 것 |
| 추천 요청형 ("좋은 카페 추천해줘") | TODO | "카페 알아보기" | 없음 | AI에게 물어볼 것 |
| 계산/비교형 ("A랑 B 뭐가 나아?") | TODO | "A vs B 비교" | 없음 | AI에게 물어볼 것 |
| 감정 표현형 ("오늘 진짜 힘들다") | NOTES (INBOX) | "오늘 힘들었음" | — | 감정 |
| 의도 모호 | NOTES (INBOX) | 원문 기반 | — | — |

### 2.4 분류 수정 (Phase 1)

**트리거:** 캡처 항목의 분류 칩 탭 (또는 AI 분류 현황 시트에서 드롭다운 탭)

**동작:**

| 단계 | 동작 |
| --- | --- |
| 1 | 분류 칩 탭 → 드롭다운 메뉴 표시 |
| 2 | 드롭다운: 4개 옵션 (일정 / 할 일 / 노트 / 아이디어) 중 현재 유형 하이라이트 |
| 3 | 새 유형 탭 → 분류 변경 트랜잭션 실행 |
| 4 | 드롭다운 닫힘 + 칩 업데이트 + 완료 피드백 |

**파생 객체 처리 상세:**

| 변경 방향 | 파생 처리 | 추가 UX |
| --- | --- | --- |
| 일정→할일 | Schedule 삭제 + Todo 생성 | SYNCED이면 "캘린더 이벤트도 삭제됩니다" 토스트 |
| 일정→노트/아이디어 | Schedule 삭제 + Note 생성 | 동일 |
| 할일→일정 | Todo 삭제 + Schedule 생성 | 사용자 명시적 변경이므로 자동 처리 |
| 할일→노트/아이디어 | Todo 삭제 + Note 생성 | 즉시 처리 |
| 노트/아이디어→일정 | Note 삭제 + Schedule 생성 | 사용자 명시적 변경이므로 자동 처리 |
| 노트/아이디어→할일 | Note 삭제 + Todo 생성 | 즉시 처리 |
| 노트↔아이디어 | note_sub_type만 변경 (INBOX↔IDEA) | folder_id 업데이트 |

**분류 수정 로깅 (Phase 2a):** 수정 시 ClassificationLog 레코드 생성 + analytics 이벤트 발행.

### 2.5 Temp 재분류 (Phase 1)

**트리거:** WorkManager 주기적 작업 (네트워크 연결 + 충전 중 조건)

**동작:**

| 단계 | 동작 |
| --- | --- |
| 1 | classified_type=TEMP인 캡처 조회 |
| 2 | 서버 POST /api/v1/classify/batch에 일괄 요청 |
| 3 | 분류 성공 항목: Capture 업데이트 + 파생 엔티티 생성 |
| 4 | 분류 실패 항목: TEMP 유지 (다음 주기 재시도) |

**주기:** 최소 15분 간격 (WorkManager 제약). 네트워크 복구 시 즉시 1회 실행.

### 2.6 수정 이력 기반 학습 (Phase 3b, 구독)

**입력:** ClassificationLog의 original_type → new_type 매핑 + 원문 특성(길이, 키워드, 엔티티 패턴)

**최소 데이터 요구:** 수정 이력 최소 20건 축적 후 개인화 모델 활성화.

**적용 방식:**

| 단계 | 동작 |
| --- | --- |
| 1 | 서버에서 사용자별 수정 이력 분석 (original_type, new_type, 원문 특성) |
| 2 | 사용자별 분류 선호 프로필 생성 (예: "짧은 문장은 TODO 선호", "장소 포함 시 SCHEDULE 선호") |
| 3 | 분류 요청 시 user_context.modification_history에 프로필 요약 포함 |
| 4 | AI 프롬프트에 개인화 컨텍스트 반영 → 분류 정확도 향상 |

**효과 측정:** 개인화 적용 전/후 분류 수정률 비교. 수정률이 개선되지 않으면 비활성화.

### 2.7 분류 프리셋 / 사용자 지시 (Phase 3b, 구독)

**프리셋:** 사전 정의 프로필 ("할 일 중심", "메모 중심") 선택 시 서버 분류 요청에 프리셋 ID 포함.

**사용자 지시:** 자연어 규칙 (예: "카페 관련은 항상 아이디어로") → 서버에 전달하여 분류 프롬프트에 포함.

---

## 3. 홈 화면

### 3.1 홈 메인 화면 (Phase 1)

홈 화면은 캡처 전용 인터페이스다. 앱의 핵심 동작인 "즉시 입력"에 집중하며, 다른 정보는 최소한으로 배치한다.

**역할:**
- 캡처 입력의 즉시 접근 (Just Capture 원칙)
- AI 분류 결과 확인의 진입점 (알림 벨)
- 설정 접근

**구성 요소:**

| 영역 | 내용                              | 위치 |
| --- |---------------------------------| --- |
| Top Bar 좌 | 앱 타이틀 "Kairos"                  | 좌상단 |
| Top Bar 우 | 알림 벨 아이콘 (뱃지) + 시계 아이콘 + 설정 아이콘 | 우상단 |
| 날짜 | 현재 날짜 표시 (예: "2026년 2월 6일 금요일") | 상단 중앙 |
| 메인 영역 | 빈 상태 또는 빈 상태 일러스트               | 중앙 |
| 하단 입력바 | 이미지 첨부(📎) + 텍스트 입력 + 전송(↑)     | 하단 고정 |

**알림 벨 뱃지:**
- 미확인 AI 분류 항목 수를 뱃지로 표시
- 탭 시 AI 분류 현황 시트 오버레이 (3.2 참조)
- 모든 항목 확인 완료 시 뱃지 제거

**시계 아이콘:**
- 사용자 기록 히스토리로 표시
- 탭 시 새로운 페이지로 이동하면서 사용자의 입력 현황 및 분류 현황 타임라인에 따라 표시

**빈 상태:** 캡처 이력이 없을 때 중앙에 일러스트 + "첫 번째 생각을 적어보세요" 표시.

**캡처 완료 시:** 입력바 초기화 + 알림 벨 뱃지 카운트 증가.

### 3.2 AI 분류 현황 시트 (Phase 1)

**트리거:** 홈 화면 알림 벨 아이콘 탭

**형태:** 하단에서 올라오는 바텀시트 오버레이 (화면 ~70% 높이)

**구성:**

| 영역 | 내용 |
| --- | --- |
| 헤더 좌 | "AI 분류 현황" 타이틀 + "24시간 이내 분류된 항목" 서브타이틀 |
| 헤더 우 | "전체 확인" 버튼 |
| 리스트 | 미확인 분류 항목 리스트 |

**리스트 아이템 구조:**

```
┌──────────────────────────────────────────┐
│ [일정 ▾]  내일 오후 3시 디자인 리뷰  방금  [확인] │
└──────────────────────────────────────────┘
```

| 요소 | 동작 |
| --- | --- |
| 분류 드롭다운 (예: [일정 ▾]) | 탭 시 드롭다운 열림: 일정 / 할 일 / 노트 / 아이디어 |
| AI 제목 | 분류된 항목 제목 (탭 시 해당 항목 상세 보기로 이동) |
| 상대 시간 | "방금", "10분 전", "1시간 전" 등 |
| [확인] 버튼 | 탭 시 해당 항목을 "확인됨"으로 처리 → 리스트에서 제거 |

**"전체 확인" 버튼:** 리스트의 모든 미확인 항목을 일괄 확인 처리.

**표시 범위:** 최근 24시간 이내 AI 분류가 완료되고, 사용자가 아직 확인하지 않은 항목만 표시.

**빈 상태:** 미확인 항목이 없을 때 "새로운 분류 결과가 없습니다" 표시.

**전체 히스토리 진입:** 시트 하단에 "전체 기록 보기 →" 링크 → 전체 히스토리 화면으로 이동 (3.3 참조).

### 3.3 전체 히스토리 (Phase 1)

**진입:** AI 분류 현황 시트 하단 "전체 기록 보기" 링크

**목적:** 사용자가 모든 캡처 이력을 시간순으로 탐색할 수 있는 화면.

**데이터:** 전체 캡처를 created_at 역순으로 표시 (삭제/휴지통 제외).

**리스트 아이템 구조:**

| 요소 | 내용 | 표시 조건 |
| --- | --- | --- |
| 1행: 제목 | ai_title 또는 original_text (짧은 경우) | 항상 |
| 1행 우측: 시간 | "방금" / "3분 전" / "어제" 등 상대 시간 | 항상 |
| 2행: 프리뷰 | original_text 첫 줄 (말줄임) | ai_title ≠ original_text인 경우만 |
| 분류 칩 | 유형 표시 (탭하여 드롭다운으로 변경 가능) | classified_type ≠ TEMP |
| 태그 | 태그 1-2개 | 공간 여유 시 |
| 분류 중 표시 | 로딩 인디케이터 | classified_type=TEMP이고 네트워크 가용 |

**페이지네이션:** 20건 단위 무한 스크롤.

**필터 (Phase 2b):** 분류 유형 칩 필터 (전체 / 할 일 / 일정 / 노트 / 아이디어), 날짜 범위 필터.

**인터랙션:**

| 동작 | 결과 |
| --- | --- |
| 아이템 탭 | 상세 보기 화면 전환 |
| 분류 칩 탭 | 유형 변경 드롭다운 |
| 좌→우 스와이프 | 삭제 (Snackbar 실행 취소 → 휴지통) |

---

## 4. 공유 인텐트

### 4.1 텍스트 수신 (Phase 1)

**트리거:** 외부 앱에서 "공유하기" → Kairos 선택 시 Intent.ACTION_SEND 수신

**동작:**

| 단계 | 동작 |
| --- | --- |
| 1 | Intent에서 EXTRA_TEXT 추출 |
| 2 | 텍스트가 비어있으면 무시 |
| 3 | URL 포함 여부 감지 |
| 4 | Capture 레코드 생성 (source=SHARE_INTENT) |
| 5 | 완료 토스트 표시: "캡처 완료" |
| 6 | AI 분류 → URL 포함 시 NOTES(BOOKMARK)로 분류 가능 |

**미지원 형식 (Phase 1):** EXTRA_STREAM(파일)만 있고 텍스트 없는 경우 → "텍스트만 지원됩니다" 토스트.

### 4.2 이미지 수신 (Phase 2a)

텍스트+이미지 혼합 또는 이미지 단독. 이미지 단독 시 classified_type=TEMP.

---

## 5. 캘린더 탭

플래너 탭을 캘린더 탭으로 재정의한다. 일정과 할 일을 단일 화면에서 통합 관리한다.

### 5.1 캘린더 메인 화면 (Phase 1)

**역할:** 오늘/선택 날짜의 일정과 할 일을 한 눈에 확인하는 통합 뷰.

**구성 (위에서 아래):**

| 영역 | 내용 | Phase |
| --- | --- | --- |
| Top Bar | "Calendar" 타이틀 | 1 |
| 주간 캘린더 스트립 | 현재 주 날짜 + 이벤트 도트 | 1 |
| 일정 섹션 | 선택 날짜의 일정 타임라인 | 1 |
| Google Calendar 링크 | "Google Calendar에서 보기" 버튼 | 2a |
| 할 일 섹션 | 할 일 리스트 | 1 |

### 5.2 주간 캘린더 스트립 (Phase 1)

**구성:**

```
┌──────────────────────────────────┐
│  1월 15일 수요일              ▾   │  ← 날짜 헤더 (탭 시 월간 뷰 전환, Phase 2a)
│  일  월  화  수  목  금  토       │  ← 요일 라벨
│  12  13  14 (15) 16  17  18      │  ← 날짜 (오늘 강조)
│      ●       ●       ●           │  ← 이벤트 도트
└──────────────────────────────────┘
```

| 요소 | 동작 |
| --- | --- |
| 날짜 탭 | 해당 날짜 선택 → 일정 섹션 업데이트 |
| 좌우 스와이프 | 주 이동 |
| 오늘 날짜 | 원형 배경으로 강조 |
| 이벤트 도트 | 해당 날짜에 일정이 있으면 도트 표시 |
| 날짜 헤더 ▾ | 월간 뷰 전환 (Phase 2a) |

### 5.3 일정 섹션 (Phase 1)

**데이터:** captures WHERE classified_type=SCHEDULE JOIN schedules, 선택 날짜 기준 start_time 순.

**타임라인 형태:**

```
일정
──────────────────────
10:00  ●  ┌───────────────────┐
          │ 팀 스탠드업  [Work]  │
          │ Zoom               │
          └───────────────────┘
14:00  ●  ┌───────────────────┐
          │ 오후 2시 미팅 [Work] │
          │ Conference Room A  │
          └───────────────────┘
18:30  ●  ┌───────────────────┐
          │ Gym Session [Personal]│
          │ Fitness Center B1  │
          └───────────────────┘
          
          [Google Calendar에서 보기]  ← Phase 2a
```

**일정 아이템 구성:**

| 요소 | 설명 |
| --- | --- |
| 시간 | start_time 포맷 (HH:mm) |
| 타임라인 도트 | 시간 옆 점 표시 |
| 제목 | ai_title |
| 태그 칩 | Work, Personal 등 태그 |
| 장소 | location (있으면) |

**인터랙션:**

| 동작 | 결과 |
| --- | --- |
| 일정 아이템 탭 | 일정 상세 보기 (5.5) |
| 좌→우 스와이프 | 삭제 (Snackbar → 휴지통) |

**빈 상태:** 선택 날짜에 일정이 없으면 "일정이 없습니다" 텍스트.

**"Google Calendar에서 보기" 버튼 (Phase 2a):** Google Calendar 앱 딥링크로 해당 날짜 열기. Google 미연동 시 "Google Calendar 연동하기" 버튼으로 대체.

### 5.4 할 일 섹션 (Phase 1)

**데이터:** captures WHERE classified_type=TODO JOIN todos WHERE is_completed=false, sort_order 순.

**리스트 형태:**

```
할 일
──────────────────────
┌──────────────────────────────────────┐
│ ≡  프로젝트 기획 검토  [Work]  마감 12:00  □ │
│ ≡  보고서 작성      [Work]  마감 18:00  □ │
│ ≡  독서 30분       [Personal]           ☑ │  ← 완료됨
└──────────────────────────────────────┘
```

**할 일 아이템 구성:**

| 요소 | 위치 | 설명 |
| --- | --- | --- |
| 드래그 핸들 (≡) | 좌 | 드래그하여 순서 변경 (Phase 2a) |
| AI 제목 | 좌-중앙 | 텍스트 |
| 태그 칩 | 제목 우측 | 태그 표시 |
| 마감일/시간 | 우-중앙 | "마감 12:00", "2/15(토)" 등. 없으면 비표시 |
| 체크박스 | 우 | 탭 시 완료 처리 |

**인터랙션:**

| 동작 | 결과 |
| --- | --- |
| 체크박스 탭 | 완료 처리 + 리스트에서 제거 (애니메이션) |
| 아이템 탭 (체크박스 외) | 할 일 상세 보기 (5.6) |
| 좌→우 스와이프 | 삭제 (Snackbar → 휴지통) |
| 드래그 (Phase 2a) | 순서 변경 (sort_source=USER) |

**완료 항목 보기 (Phase 2a):**

| 토글 상태 | 표시 |
| --- | --- |
| 닫힘 (기본) | "완료 항목 보기 (N)" 텍스트만 |
| 열림 | 완료 항목 리스트 (체크 상태, 취소선, 완료 일시) |

**빈 상태:** 할 일이 없으면 "할 일이 없습니다" 텍스트.

### 5.5 일정 상세 보기 (Phase 2a)

**구성:**

| 영역 | 내용 | 편집 |
| --- | --- | --- |
| 뒤로 가기 | [←] 버튼 | — |
| 삭제 | [🗑️] 버튼 | — |
| 제목 | ai_title | 가능 |
| 분류 칩 | 유형 드롭다운 + 태그 | 변경 가능 |
| 날짜/시간 | start_time ~ end_time | 가능 |
| 장소 | location | 가능 |
| 캘린더 상태 | 동기화 상태 표시 + 액션 버튼 | — |
| 원본 텍스트 | original_text | 수정 불가 |
| 작성 날짜 | created_at 포맷 ("N시간 전 캡처") | — |

**캘린더 상태 표시 (Phase 2a):**

| 상태 | 표시 |
| --- | --- |
| SYNCED | "✓ Google Calendar 등록됨" + [실행 취소] |
| SUGGESTION_PENDING | "캘린더에 추가할까요?" + [추가] [아니오] |
| NOT_LINKED | Google 미연동 시 "캘린더 연동하기" |
| SYNC_FAILED | "동기화 실패" + [다시 시도] |

### 5.6 할 일 상세 보기 (Phase 1)

**구성:**

| 영역 | 내용 | 편집 |
| --- | --- | --- |
| 뒤로 가기 | [←] 버튼 | — |
| 삭제 | [🗑️] 버튼 | — |
| 체크박스 + 제목 | ai_title | 제목 편집 가능 |
| 분류 칩 | 유형 드롭다운 + 태그 | 변경 가능 |
| 마감일 | deadline (날짜 피커로 설정) | 가능 |
| 마감일 출처 | AI_SUGGESTED인 경우 "AI 제안" 표시 (점선 테두리) | — |
| 원본 텍스트 | original_text | 수정 불가 |
| 작성 날짜 | created_at 포맷 | — |

### 5.7 Google Calendar 동기화 (Phase 2a)

**일정 자동 추가 안전장치 — 상세 플로우:**

**A. 기본 모드 ("제안"):**

모든 일정은 calendar_sync_status=SUGGESTION_PENDING으로 시작.

| 단계 | 동작 |
| --- | --- |
| 1 | AI 분류 완료, SCHEDULE 확정 |
| 2 | 입력 소스에 따라 제안 방식 결정 (아래 표) |
| 3a | 사용자 승인 → Google Calendar API로 이벤트 생성 → SYNCED |
| 3b | 사용자 거부 → REJECTED |
| 3c | 무시 (일정 날짜 경과) → EXPIRED |

**입력 소스별 제안 방식:**

| 입력 소스 | 제안 방식 | 이유 |
| --- | --- | --- |
| APP (앱 내 직접 입력) | 인앱 배너 (AI 분류 현황 시트 + 일정 상세 보기) | 앱 사용 중이므로 인앱 UI 활용 |
| WIDGET (홈 화면 위젯) | 푸시 알림 "[일정 제목] — 캘린더에 추가할까요?" + [추가] [아니오] | 앱 미진입 상태이므로 푸시 활용 |
| SHARE_INTENT (외부 공유) | 푸시 알림 (WIDGET과 동일) | 앱 미진입 상태이므로 푸시 활용 |

**B. 완전 자동 모드:**

사용자가 설정에서 활성화한 경우.

| 신뢰도 | 동작 |
| --- | --- |
| HIGH | 즉시 Google Calendar 이벤트 생성 + 푸시 알림 (실행 취소 포함) |
| MEDIUM | 제안 모드와 동일 |
| LOW | 제안 모드와 동일 |

**HIGH 자동 추가 후 실행 취소:**

| 단계 | 동작 |
| --- | --- |
| 1 | 푸시 알림: "[일정]이 캘린더에 추가됨" + [실행 취소] 액션 |
| 2 | [실행 취소] 탭 (1시간 이내) → Google Calendar 이벤트 삭제 → NOT_LINKED |
| 3 | 1시간 경과 → 실행 취소 비활성화 |

**신뢰도 판별 기준 (서버 AI):**

| 신뢰도 | 조건 |
| --- | --- |
| HIGH | 명확한 날짜 + 시간 + 이벤트/장소 모두 식별 |
| MEDIUM | 날짜는 있으나 시간 불확실, 또는 상대 표현 ("다음 주") |
| LOW | 일정 가능성은 있으나 핵심 정보 부족 ("언제 한번 만나자") |

**주간/월간 뷰 (Phase 2a):**

주간 뷰는 캘린더 스트립(5.2)으로 대체. 월간 뷰는 캘린더 스트립 헤더의 ▾ 탭 시 확장 표시.

**월간 뷰 확장:**

| 동작 | 결과 |
| --- | --- |
| 캘린더 헤더 ▾ 탭 | 월 캘린더 그리드 확장 표시 |
| 일정이 있는 날짜 | 도트 표시 |
| 날짜 탭 | 해당 날짜 선택 + 월간 뷰 접힘 + 일정 섹션 업데이트 |

**Google Calendar 읽기 캐시:** Google Calendar API에서 읽어온 일정을 Room DB에 캐시. 오프라인에서도 캘린더 뷰 렌더링 가능.

---

## 6. 할 일 관리

### 6.1 할 일 목록 (Phase 1)

**데이터:** captures WHERE classified_type=TODO JOIN todos, sort_order 순.

**기본 표시:** is_completed=false인 항목만 표시.

**정렬 순서:**

| 우선순위 | 기준 | Phase |
| --- | --- | --- |
| 1 | sort_source=USER인 항목은 사용자 설정 위치 유지 | 2a |
| 2 | deadline이 있는 항목 → deadline 오름차순 (가까운 마감 먼저) | 1 |
| 3 | deadline이 없는 항목 → created_at 역순 (최근 생성 먼저) | 1 |

**마감일 표시 형식:**

| 조건 | 표시 형식 | 예시 |
| --- | --- | --- |
| 오늘 마감 | "마감 HH:mm" | "마감 12:00" |
| 오늘 이후 마감 | "M/d(요일)" | "2/15(토)" |
| 마감일 없음 | 비표시 | — |
| 마감 초과 | "마감 초과" + 날짜 | "마감 초과 · 2/13" |

### 6.2 완료 처리 (Phase 1)

**트리거:** 체크박스 탭

**동작:**

| 단계 | 동작 |
| --- | --- |
| 1 | is_completed = true, completed_at = now |
| 2 | 체크 애니메이션 표시 (0.3초) |
| 3 | 리스트에서 슬라이드 아웃 제거 (0.5초 딜레이) |
| 4 | 완료 항목 카운터 업데이트 |

**완료 취소:** 완료 항목 보기에서 체크박스 재탭 → is_completed=false, completed_at=null → 활성 리스트로 복원.

**완료 항목 보기 (Phase 2a):**

| 항목 | 설명 |
| --- | --- |
| 토글 텍스트 | "완료 항목 보기 (N)" |
| 표시 내용 | 체크 상태 + 취소선 제목 + 완료 일시 |
| 정렬 | completed_at 역순 (최근 완료 먼저) |
| 인터랙션 | 체크박스 재탭으로 완료 취소 |

### 6.3 AI 마감일 제안 (Phase 2a)

**조건:** AI 분류 시 날짜 정보가 텍스트에서 추출된 경우, todo_info.deadline으로 전달.

**deadline_source 분류:**

| 소스 | 설명 | 예시 |
| --- | --- | --- |
| AI_EXTRACTED | 명시적 날짜 언급 | "금요일까지 보고서" → 해당 금요일 |
| AI_SUGGESTED | AI가 맥락으로 추론 | "오늘 날씨 확인" → 오늘 |
| USER_SET | 사용자 직접 설정 | 상세 보기에서 수정 |

**AI_SUGGESTED 표시:** 일반 마감일과 시각적으로 구분 (점선 테두리 등). 사용자가 탭하면 확정(USER_SET)으로 전환.

---

## 7. 노트

### 7.1 폴더 구조 및 서브 분류 (Phase 1)

**기본 시스템 폴더:**

| 폴더 | type | 설명 | 삭제 가능 |
| --- | --- | --- | --- |
| Inbox | INBOX | 미분류 노트의 기본 배치. NOTES로 분류되면 기본적으로 여기에 저장 | 불가 |
| Ideas | IDEAS | 아이디어로 분류된 노트 | 불가 |
| Bookmarks | BOOKMARKS | URL이 포함된 공유 인텐트 등 웹 링크 | 불가 |

**사용자 생성 폴더 (Phase 1):**

사용자가 직접 추가한 폴더. 노트를 사용자 정의 분류로 관리하기 위한 용도.

| 속성 | 설명 |
| --- | --- |
| type | USER |
| 생성 | 사용자 수동 생성 |
| 삭제 | 가능. 삭제 시 소속 노트는 Inbox로 이동 |
| 이름 | 사용자 지정 |

**폴더 표시 순서:** Inbox (잔류 항목 있을 때만 표시) → Ideas → Bookmarks → 사용자 폴더 (생성 순).

**AI 분류 시 서브 분류 결정:**

| AI 판단 | note_sub_type | folder_id |
| --- | --- | --- |
| 아이디어성 내용 | IDEA | system-ideas |
| URL 포함 | BOOKMARK | system-bookmarks |
| 그 외 | INBOX | system-inbox |

### 7.2 노트 폴더 관리 (Phase 1)

**폴더 생성:**

| 단계 | 동작 |
| --- | --- |
| 1 | 노트 메인 화면에서 [+] 또는 "새 폴더" 버튼 탭 |
| 2 | 폴더 이름 입력 다이얼로그 |
| 3 | 이름 입력 + 확인 → Folder 레코드 생성 (type=USER) |

**폴더 이름 규칙:**

| 규칙 | 설명 |
| --- | --- |
| 최소 길이 | 1자 이상 |
| 최대 길이 | 30자 |
| 중복 | 동일 이름 불가 (시스템 폴더명 포함) |

**폴더 삭제:**

| 단계 | 동작 |
| --- | --- |
| 1 | 폴더 롱프레스 또는 폴더 내 설정에서 삭제 |
| 2 | "폴더를 삭제하면 노트는 Inbox로 이동합니다" 확인 |
| 3 | 소속 노트의 folder_id → system-inbox로 변경 |
| 4 | Folder 레코드 삭제 |

**폴더 이름 수정:** 폴더명 롱프레스 → 이름 수정 다이얼로그.

**노트 폴더 이동:**

| 동작 | 결과 |
| --- | --- |
| 노트 상세 보기에서 폴더 탭 | 폴더 선택 시트 표시 → 선택 시 folder_id 변경 |
| 노트 리스트에서 롱프레스 | 이동 옵션 제공 |

### 7.3 노트 메인 화면 (Phase 1)

**구성:**

| 영역 | 내용 |
| --- | --- |
| Top Bar | "노트" 타이틀 + 검색 아이콘 (🔍) |
| 폴더 리스트 | 시스템 폴더 + 사용자 폴더 |
| 새 폴더 버튼 | [+ 새 폴더] |

**폴더 아이템:** 폴더명 + 노트 수. 탭 시 폴더 내 노트 리스트로 이동.

**Inbox 표시 규칙:**

| 조건 | 표시 |
| --- | --- |
| Inbox 항목 0개 | Inbox 폴더 숨김 |
| Inbox 항목 1개 이상 | Inbox 폴더 표시 (최상단) |

### 7.4 노트 상세 보기 / 편집 (Phase 2b)

**구성:**

| 영역 | 내용 | 편집 |
| --- | --- | --- |
| 뒤로 가기 | [←] 버튼 | — |
| 삭제 | [🗑️] 버튼 | — |
| 저장 | [저장] 버튼 (변경사항 있을 때만 활성화) | — |
| 제목 | ai_title | 가능 |
| 분류 칩 | 유형 드롭다운 (노트/아이디어) + 태그 | 변경 가능 |
| 태그 | 태그 목록 + [+] 추가 버튼 | 편집 가능 |
| 본문 | body (null이면 original_text 표시) | Phase 2b부터 편집 가능 |
| 원본 텍스트 | original_text (body가 있으면 접힌 상태) | 수정 불가 |
| 소속 폴더 | folder 이름 (탭하여 이동 가능) | Phase 1 |
| 작성 날짜 | created_at 포맷 (예: "2026년 2월 6일 14:30") | — |

**저장 동작:**

| 트리거 | 동작 |
| --- | --- |
| [저장] 버튼 탭 | 변경사항 Room DB에 저장 + "저장됨" 토스트 |
| [←] 뒤로가기 (변경사항 있을 때) | "변경사항을 저장할까요?" 다이얼로그 → [저장] / [버리기] |
| [←] 뒤로가기 (변경사항 없을 때) | 즉시 뒤로 이동 |

### 7.5 검색 (Phase 1)

**진입:** 노트 메인 화면 상단 검색 아이콘 (🔍) 탭

**범위:** 전체 캡처 대상 검색 (노트뿐 아니라 할 일, 일정 포함).

**동작:**

| 단계 | 동작 |
| --- | --- |
| 1 | 검색 화면 전환 (전체 화면 오버레이) |
| 2 | 검색 입력 + 실시간 결과 표시 |
| 3 | FTS 검색: ai_title > tag_text > entity_text > original_text 우선순위 |
| 4 | 결과 리스트: 히스토리 아이템과 동일한 구조 (분류 칩 포함) |

**필터 (Phase 2b):** 분류 유형 칩 필터, 날짜 범위 필터.

**검색 결과 없음:** "결과 없음" + "다른 키워드로 검색해보세요".

### 7.6 Inbox AI 자동 분류 (Phase 3a, 구독)

**목적:** 노트 Inbox에 쌓인 미분류 노트를 AI가 자동으로 적절한 폴더(Ideas, Bookmarks, 사용자 폴더, AI 그룹)로 분류.

**동작 모드:**

**A. 상시 자동 분류 (구독 상태):**

| 단계 | 동작 |
| --- | --- |
| 1 | WorkManager 주기적 작업 (네트워크 + 충전 조건) |
| 2 | Inbox 폴더의 노트 조회 |
| 3 | 서버에 노트 제목 + 태그 + 기존 폴더 구조 전송 |
| 4 | AI가 각 노트의 적절한 폴더 결정 |
| 5 | 자동으로 folder_id 업데이트 |

**주기:** 최소 1시간 간격. Inbox에 새 노트가 5개 이상 축적 시 즉시 실행.

**B. 비구독 상태:** 자동 분류 비활성. Inbox의 노트는 사용자가 수동으로 폴더 이동.

### 7.7 AI 자동 그룹화 및 재정리 (Phase 3a, 구독)

**목적:** 노트를 토픽 기반으로 자동 그룹화하고, 필요 시 전체 노트를 재분류.

**동작 모드:**

**A. 상시 자동 그룹화 (구독 상태):**

| 단계 | 동작 |
| --- | --- |
| 1 | WorkManager 주기적 작업 (구독 활성 + 네트워크 + 충전) |
| 2 | Inbox 폴더의 노트 중 그룹화 대상 조회 |
| 3 | 서버에 노트 제목 + 태그 + 기존 폴더/그룹 구조 전송 |
| 4 | AI가 토픽 기반 그룹 결정 |
| 5 | Folder(type=AI_GROUP) 생성 (새 그룹) 또는 기존 그룹에 배치 |
| 6 | 해당 노트의 folder_id 업데이트 |

**조건:** NOTE/IDEA 타입 캡처가 10개 이상 축적 시 그룹화 시작.

**B. "AI 분류" 버튼 (전체 재정리):**

사용자가 새로 구독했거나, 기존 분류가 만족스럽지 않을 때 수동 실행.

| 단계 | 동작 |
| --- | --- |
| 1 | 노트 탭 또는 설정에서 "AI 분류" 버튼 탭 |
| 2 | 전체 노트 인덱싱 (제목, 태그, 원문 키워드) |
| 3 | 서버에 전체 노트 메타데이터 전송 |
| 4 | AI가 새로운 폴더 구조 제안 (기존 폴더 유지/병합/신규 생성) |
| 5 | Before/After 비교 화면 표시 (디렉토리 구조) |
| 6a | 사용자 "적용" → 전체 folder_id 업데이트 + 새 폴더 생성 |
| 6b | 사용자 "취소" → 변경 없음 |

**Before/After 비교 화면:**

```
┌────────────────┬────────────────┐
│     현재        │     제안        │
├────────────────┼────────────────┤
│ 📁 Inbox (15)  │ 📁 Inbox (3)   │
│ 📁 Ideas (8)   │ 📁 Ideas (8)   │
│                │ 📁 프론트엔드 (5)│ ← 신규 그룹
│                │ 📁 독서 메모 (4) │ ← 신규 그룹
│                │ 📁 회의 관련 (3) │ ← 신규 그룹
├────────────────┼────────────────┤
│  [취소]         │         [적용]  │
└────────────────┴────────────────┘
```

---

## 8. 휴지통

### 8.1 휴지통 (Phase 2a)

**목적:** 삭제된 항목을 30일간 보관하여 실수로 인한 영구 데이터 손실을 방지.

**진입:** 설정 화면 또는 노트/캘린더 탭의 보조 메뉴.

**표시 내용:**

| 요소 | 설명 |
| --- | --- |
| 항목 리스트 | 휴지통 내 항목 (trashed_at 역순) |
| 각 아이템 | ai_title + 분류 칩 + 삭제 날짜 + 남은 일수 |
| 복원 버튼 | 각 아이템에 복원 버튼 |
| 전체 비우기 | 휴지통 전체 영구 삭제 (확인 다이얼로그 필요) |

**복원 동작:**

| 단계 | 동작 |
| --- | --- |
| 1 | 복원 버튼 탭 |
| 2 | is_trashed=false, trashed_at=null, is_deleted=false |
| 3 | 원래 분류 유형에 따라 해당 섹션에 복원 |
| 4 | "복원됨" 토스트 표시 |

**자동 정리:** WorkManager 일간 작업으로 trashed_at + 30일 경과 항목 Hard Delete.

**전체 비우기:**

| 단계 | 동작 |
| --- | --- |
| 1 | "전체 비우기" 탭 |
| 2 | "휴지통의 모든 항목이 영구 삭제됩니다. 이 작업은 되돌릴 수 없습니다." 확인 다이얼로그 |
| 3 | 확인 → 전체 Hard Delete |

---

## 9. 위젯

### 9.1 입력 위젯 (Phase 2a)

**형태:** 4×1 홈 화면 위젯. 텍스트 입력 필드 + 전송 버튼.

**동작:** 위젯 입력 필드 탭 → 앱 캡처 화면 전환 (키보드 자동 올림) 또는 위젯 내 직접 입력(RemoteViews 제약에 따라 결정).

**일정 분류 시:** 앱 미진입 상태이므로 푸시 알림으로 일정 제안 (5.7 참조).

### 9.2 할 일 위젯 (Phase 2b)

**형태:** 4×2 이상. 오늘 마감 할 일 리스트 + 체크박스.

**데이터:** todos WHERE deadline ≤ 오늘 23:59 AND is_completed=false.

**체크박스 탭:** 위젯에서 바로 완료 처리 → Room DB 업데이트 → 위젯 갱신.

---

## 10. 알림

### 10.1 앱 내 알림 (Phase 1)

| 이벤트 | 표시 | 형태 |
| --- | --- | --- |
| 캡처 저장 완료 | "저장됨" | Snackbar 2초 |
| AI 분류 완료 | 알림 벨 뱃지 카운트 증가 | 뱃지 업데이트 |
| 오프라인 상태 | 상단 배너 "오프라인 — 연결되면 자동 동기화" | 상태 바 |

### 10.2 푸시 알림 (Phase 2a+)

| 유형 | 내용 | 액션 | Phase |
| --- | --- | --- | --- |
| 일정 자동 추가 | "[일정]이 캘린더에 추가됨" | [실행 취소] [확인] | 2a |
| 일정 제안 | "[일정] — 캘린더에 추가할까요?" | [추가] [아니오] | 2a |
| 일정 제안 (위젯/공유) | 위젯·공유 인텐트 입력의 일정 분류 시 | [추가] [아니오] | 2a |

**알림 채널:** Android Notification Channel로 유형별 분리 (사용자가 개별 on/off 가능).

---

## 11. 온보딩

### 11.1 Phase 1 온보딩

**화면 1:** 앱 소개 — "적으면 알아서 정리됩니다" + 핵심 가치 일러스트

**화면 2:** AI 분류 안내 — "AI가 자동으로 분류합니다. 틀리면 탭 한 번으로 수정하세요"

**화면 3:** 첫 캡처 유도 — 입력창 + "첫 번째 생각을 적어보세요" 플레이스홀더

### 11.2 Phase 2a 온보딩

**Google 연동:** "Google 계정을 연결하면 일정이 캘린더에 자동 등록됩니다" + [연결하기] [나중에]

### 11.3 Phase 2b 온보딩

**위젯 가이드:** "홈 화면에 위젯을 추가하면 더 빠르게 캡처할 수 있습니다" + 추가 방법 안내

---

## 12. 설정

### 12.1 설정 구조

| 카테고리 | 항목 | 동작 | Phase | 구독 |
| --- | --- | --- | --- | --- |
| **표시** | 다크 모드 | 시스템/라이트/다크 전환 | 1 | — |
| **연동** | Google Calendar | 연동 on/off + 계정 선택 | 2a | — |
| **AI 설정** | 일정 추가 모드 | "제안"/"완전 자동" 토글 | 2a | — |
| **AI 설정** | 분류 프리셋 | 프리셋 선택 목록 | 3b | 구독 |
| **AI 설정** | 분류 지시 | 자연어 입력 필드 | 3b | 구독 |
| **알림** | 일정 추가 알림 | on/off | 2a | — |
| **내 정보** | 연동 계정 | Google 계정 표시 | 2a | — |
| **내 정보** | 구독 현황 | 플랜 + 사용량 | 3a | — |
| **내 정보** | 로그아웃 | 로그아웃 | 3a | — |
| **데이터** | 휴지통 | 휴지통 화면 진입 | 2a | — |
| **정보** | 개인정보 처리방침 | WebView 표시 | 1 | — |
| **정보** | 이용약관 | WebView 표시 | 1 | — |
| **정보** | 앱 버전 | 버전 텍스트 | 1 | — |

### 12.2 항목별 세부 요구사항

**다크 모드:**

| 옵션 | 설명 |
| --- | --- |
| 시스템 (기본값) | 시스템 설정 따름 |
| 라이트 | 항상 라이트 모드 |
| 다크 | 항상 다크 모드 |

UI: 3개 라디오 버튼. 변경 즉시 적용 (앱 재시작 불필요).

**Google Calendar 연동 (Phase 2a):**

| 상태 | 표시 | 액션 |
| --- | --- | --- |
| 미연동 | "Google Calendar" + [연결하기] | Google OAuth 플로우 시작 |
| 연동됨 | "Google Calendar" + 계정 이메일 + [연결 해제] | 토큰 삭제 + 동기화 해제 |

연결 해제 시: "연결을 해제하면 캘린더 동기화가 중단됩니다. 기존에 동기화된 이벤트는 Google Calendar에 유지됩니다." 확인.

**일정 추가 모드 (Phase 2a):**

| 옵션 | 설명 | 기본값 |
| --- | --- | --- |
| 제안 | 모든 일정에 대해 사용자 확인 요청 | ✓ (기본) |
| 완전 자동 | HIGH 신뢰도 일정은 자동 추가, 나머지는 제안 | — |

UI: 토글 또는 드롭다운. "완전 자동 모드에서는 확실한 일정이 자동으로 캘린더에 추가됩니다" 설명 텍스트.

**알림 설정 (Phase 2a):**

| 항목 | 설명 | 기본값 |
| --- | --- | --- |
| 일정 추가 알림 | 일정이 캘린더에 자동 추가될 때 푸시 알림 | ON |

UI: 토글 스위치. Android 시스템 알림 설정과 연동 안내.

**휴지통 (Phase 2a):**

| 표시 | 액션 |
| --- | --- |
| "휴지통" + 항목 수 | 탭 시 휴지통 화면 (8.1) 진입 |

**개인정보 처리방침 / 이용약관 (Phase 1):** 탭 시 WebView로 URL 표시.

**앱 버전 (Phase 1):** 버전 텍스트 표시. 탭 불가.

### 12.3 구독자 전용 기능 구분

구독자 전용 기능은 설정 화면에서 다음과 같이 구분된다.

**비구독자 상태:**
- 구독 전용 항목에 🔒 아이콘 + "Premium" 뱃지 표시
- 탭 시 구독 안내 시트 표시 ("이 기능은 Premium 구독에 포함됩니다" + [구독하기] [나중에])
- 기능 자체는 비활성 (토글 불가)

**구독자 상태:**
- 🔒 아이콘 및 "Premium" 뱃지 제거
- 기능 정상 활성화

**구독 전용 기능 목록:**

| 기능 | 설정 위치 | Phase |
| --- | --- | --- |
| 분류 프리셋 | AI 설정 | 3b |
| 분류 지시 | AI 설정 | 3b |
| Inbox AI 자동 분류 | AI 설정 | 3a |
| AI 자동 그룹화 및 재정리 | AI 설정 (노트 탭에서도 접근) | 3a |
| 수정 이력 기반 학습 | AI 설정 | 3b |

---

## 13. 공유하기

### 13.1 외부 공유 기능 (Phase 3b)

**목적:** 캡처된 항목(노트, 일정, 할 일)을 외부 앱으로 공유.

**트리거:** 상세 보기 화면에서 공유 아이콘 탭

**공유 포맷:**

| 분류 유형 | 공유 텍스트 형식 |
| --- | --- |
| NOTES | "[제목]\n\n[본문 또는 원문]" |
| TODO | "[제목]\n마감: [마감일]\n\n[원문]" |
| SCHEDULE | "[제목]\n일시: [start_time]\n장소: [location]\n\n[원문]" |

**동작:**

| 단계 | 동작 |
| --- | --- |
| 1 | 공유 아이콘 탭 |
| 2 | Android Intent.ACTION_SEND로 텍스트 공유 |
| 3 | 시스템 공유 시트 표시 (카카오톡, 메시지, 이메일 등) |

---

## 14. 분류 품질 관측

### 14.1 이벤트 수집 (Phase 2a)

모든 관측 이벤트는 AnalyticsEvent 테이블에 로컬 저장 후, WorkManager로 배치 전송.

**프라이버시:** 캡처 원문은 이벤트에 포함하지 않음. input_length만 수집.

### 14.2 수집 이벤트 유형

| event_type | event_data 포함 필드 | Phase |
| --- | --- | --- |
| capture_created | source, input_length | 2a |
| classification_completed | classified_type, note_sub_type, confidence, processing_time_ms | 2a |
| classification_confirmed | capture_id, confirmed_type (변경 여부 포함) | 2a |
| classification_modified | original_type, new_type, time_since_classification_ms | 2a |
| schedule_suggestion_response | action(approved/rejected/ignored), confidence, source(app/widget/share) | 2a |
| schedule_auto_deleted | time_since_auto_add_ms | 2a |
| temp_item_resolved | resolution(ai/user), time_in_temp_ms | 2a |
| capture_revisited | time_since_creation_ms, access_method(list/search) | 2b |
| todo_completed | time_since_creation_ms | 2b |
| search_performed | result_count, result_clicked | 2b |
| trash_restored | time_in_trash_ms | 2a |
| split_capture_created | parent_capture_id, split_count | 2a |

### 14.3 핵심 관측 대시보드 지표

| 지표 | 계산 | 정상 범위 (가설) |
| --- | --- | --- |
| 분류 수정률 | 수정 건 / 전체 분류 | < 15% |
| 수정 응답 시간 중앙값 | classification_modified 이벤트의 time_since_classification_ms p50 | < 60초 |
| 일정 제안 승인율 | approved / (approved + rejected + ignored) | > 60% |
| 일정 자동 추가 후 삭제율 | schedule_auto_deleted / schedule_auto_added | < 10% |
| Temp 잔류 시간 중앙값 | temp_item_resolved의 time_in_temp_ms p50 | < 1시간 |
| 투두 완료율 (Phase 2b) | todo_completed / todo_created | > 30% |
| AI 분류 확인율 | classification_confirmed(변경 없음) / 전체 확인 | > 85% |

---

## 부록 A. Phase 로드맵 요약

### Phase 1: MVP

캡처, AI 분류(TEMP/TODO/SCHEDULE/NOTES), 홈 화면(캡처+AI현황), 캘린더 탭(일정+할일), 노트(폴더 구조), 공유 인텐트(텍스트), 삭제(Snackbar 실행 취소), 검색, 온보딩, 기본 설정

### Phase 2a: 코어 루프 완성

이미지 첨부(카메라 포함), 휴지통(30일 보존), Google Calendar 동기화, 일정 상세/월간 뷰, 완료 항목 보기, AI 마감일 제안, 입력 위젯, 푸시 알림, 분류 수정 로깅, 품질 관측 수집

### Phase 2b: 사용성 확장 (최소 출시 기준)

다중 의도 분리, 노트 편집, 할 일 위젯, 히스토리 필터, 확장 관측 지표

### Phase 3a: 구독 기능

Inbox AI 자동 분류, AI 자동 그룹화 및 재정리, 인증(Google OAuth), 구독 모델, 구독 현황/로그아웃

### Phase 3b: 고급 AI 및 외부 확장 (구독)

수정 이력 기반 학습, 분류 프리셋, 사용자 지시, 외부 공유, 임시 저장 암호화

---

*Document Version: 2.1 | Last Updated: 2026-02-06*
