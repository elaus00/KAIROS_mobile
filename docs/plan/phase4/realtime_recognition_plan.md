# Phase 4 연구: 실시간 인식 피드백 기능

> **문서 유형**: 연구/기획 문서 (구현 전 검토용)
> **작성일**: 2026-02-11
> **상태**: 연구 단계

---

## 1. 기능 개요

**입력 중 실시간 AI 인식 피드백**: 사용자가 텍스트를 입력하는 동안, 감지된 날짜/시간/분류 힌트를 시각적으로 표시하여 캡처 품질에 대한 즉각적 피드백을 제공한다.

### 예시
- "내일 3시에 미팅" → 입력 중 `📅 2026-02-12 15:00` 힌트 표시
- "우유 사기" → `✅ 할 일` 분류 예측 표시

---

## 2. 철학 적합성 분석

### 2.1 Just Capture 원칙과의 정합성

| 판단 기준 | 평가 |
|----------|------|
| 캡처까지의 단계를 늘리는가? | **아니오** — 입력 흐름을 방해하지 않는 패시브 표시 |
| 사용자에게 선택을 강요하는가? | **아니오** — 인식 결과를 수정할 필요 없음 (정보성) |
| 정리 부담을 전가하는가? | **아니오** — 오히려 AI 분류 신뢰도를 사전에 전달 |
| 핵심 루프를 방해하는가? | **주의 필요** — 시각적 노이즈가 과하면 방해 가능 |
| AI 분류 품질을 타협하는가? | **아니오** — 보조 피드백이며 최종 분류는 서버 |

### 2.2 분류 신뢰 원칙 (3.1)

- 인식 피드백이 입력 중에 표시되면 "AI가 이해하고 있다"는 신뢰감 형성
- 단, 피드백이 부정확할 경우 오히려 신뢰 저하 위험
- **결론**: 높은 정확도가 보장되는 항목(날짜/시간)만 표시하는 것이 안전

---

## 3. 구현 방안 비교

### 방안 A: 로컬 파싱 Only

**로컬 정규식/패턴 매칭으로 날짜, 시간, 숫자 등을 파싱**

| 항목 | 내용 |
|------|------|
| 지연 | 0ms (즉시) |
| 정확도 | 중 — 정규식 한계 (자연어 표현 "내일", "다음 주 월요일" 등) |
| 오프라인 | 완전 지원 |
| 구현 복잡도 | 낮음 |
| 서버 부하 | 없음 |

### 방안 B: AI 디바운스 호출

**입력 중지 후 300-500ms 디바운스 → 서버 AI 분류 API 호출**

| 항목 | 내용 |
|------|------|
| 지연 | 300ms + 네트워크 RTT (~200-500ms) |
| 정확도 | 높음 — 전체 AI 파이프라인 활용 |
| 오프라인 | 미지원 |
| 구현 복잡도 | 중간 |
| 서버 부하 | 높음 — 타이핑 중 반복 호출 |

### 방안 C: 하이브리드 (권장)

**로컬 날짜/시간 파싱 즉시 표시 + 입력 완료 후 서버 보정**

| 항목 | 내용 |
|------|------|
| 지연 | 0ms (로컬) + 비동기 보정 |
| 정확도 | 높음 — 로컬 즉시 + 서버 정밀 보정 |
| 오프라인 | 부분 지원 (로컬 파싱만) |
| 구현 복잡도 | 중간 |
| 서버 부하 | 낮음 — 최종 1회만 호출 |

---

## 4. 권장안: 방안 C (하이브리드)

### 4.1 아키텍처

```
입력 텍스트
    ├─ [즉시] LocalRecognizer (날짜/시간/금액 패턴)
    │       └─ RecognitionHint 리스트 → UI 인라인 표시
    │
    └─ [디바운스 1초] 서버 AI 분류 (기존 ClassifyCaptureWorker)
            └─ Classification 결과 → 최종 분류 확정
```

### 4.2 LocalRecognizer 범위

| 인식 대상 | 패턴 예시 | 정확도 |
|----------|----------|--------|
| 절대 날짜 | "2026-02-12", "2/12", "2월 12일" | 높음 |
| 상대 날짜 | "내일", "모레", "다음 주", "이번 금요일" | 중~높음 |
| 시간 | "3시", "15:00", "오후 3시" | 높음 |
| 금액 | "50,000원", "5만원" | 높음 |
| 분류 키워드 | "미팅", "회의", "사기", "예약" | 낮음 (제외 권장) |

### 4.3 UX 스케치

```
┌─────────────────────────────────────┐
│  떠오르는 생각을 자유롭게...          │
│                                     │
│  내일 3시에 팀 미팅                  │
│                                     │
│  ┌───────────────────────────┐     │
│  │ 📅 2026-02-12 (수) 15:00  │     │  ← RecognitionHint 칩
│  └───────────────────────────┘     │
│                                     │
└─────────────────────────────────────┘
```

- 힌트는 입력 영역 하단에 반투명 칩으로 표시
- 탭 시 무시 가능 (힌트 숨김)
- 입력 영역 크기를 줄이지 않음 (오버레이)

---

## 5. 위험 요소 및 대응

| 위험 | 영향 | 대응 |
|------|------|------|
| 로컬 파싱 오인식 | 잘못된 날짜 표시 → 신뢰 저하 | 높은 확신도 항목만 표시, 확신도 < 0.8 숨김 |
| 시각적 노이즈 | 입력 집중 방해 | 패시브 표시 (작은 칩), 설정에서 끄기 가능 |
| 성능 영향 | 타이핑 레이턴시 증가 | Dispatchers.Default에서 파싱, 결과만 Main에 전달 |
| 다국어 복잡성 | 한국어 날짜 표현 다양 | Phase 1: 한국어만 지원, 이후 확장 |

---

## 6. 스코프 정의

### 포함 (Phase 4 MVP)
- LocalRecognizer: 한국어 날짜/시간 파싱
- RecognitionHint UI: 입력 영역 하단 칩 표시
- 설정: 실시간 인식 ON/OFF 토글

### 제외 (후속 Phase)
- 서버 AI 실시간 호출 (방안 B 요소)
- 영어/일본어 등 다국어 지원
- 금액 인식
- 인식 결과 기반 자동 필드 채우기

---

## 7. 의존성

- 기존 캡처 입력 플로우 (CaptureContent.kt)
- FlitWritingFontFamily (기존 폰트 스타일)
- UserPreferenceRepository (설정 저장)

---

## 8. 결론

로컬 날짜/시간 파싱 기반 실시간 피드백은 Just Capture 원칙을 위반하지 않으면서 사용자 경험을 향상시킬 수 있다.
다만, 정확도가 보장되지 않는 항목(분류 키워드 등)은 제외하여 신뢰 저하를 방지해야 한다.
방안 C(하이브리드)를 권장하며, Phase 4 MVP로 한국어 날짜/시간 파싱만 우선 구현한다.
