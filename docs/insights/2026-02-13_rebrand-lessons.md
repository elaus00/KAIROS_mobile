# 리브랜딩 작업 교훈 (2026-02-13)

## 1. 멀티레포 리브랜딩 시 범위를 사전 확인할 것

서버를 전면 리브랜딩(패키지명, 환경변수, GCP 리소스 등 전부 변경)했으나,
서버는 KAIROS 프로젝트 자체이고 모바일 앱 참조만 변경 필요했음.

**교훈**: 멀티레포에서 "리브랜딩"이라 해도 각 레포의 역할과 변경 범위를 사전에 명확히 구분해야 한다.
한쪽은 "제품 이름 변경", 다른 쪽은 "클라이언트 참조 업데이트"일 수 있다.

## 2. `git add -A` 사용 시 민감 파일 주의

`git add -A`로 `.gcloud-tmp/`(인증정보 포함)이 커밋되었음.
push 전에 발견하여 squash로 히스토리에서 제거.

**교훈**: 에이전트에게 커밋을 위임할 때, `.gitignore`에 없는 민감 디렉토리가
untracked로 있을 수 있다. `git status`에서 `??` 항목을 반드시 확인할 것.

## 3. `uv sync` vs `uv sync --all-packages`

`uv sync`만으로는 workspace 멤버 패키지가 설치되지 않는다.
`uv sync --all-packages`를 사용해야 모든 workspace 패키지가 설치됨.

## 4. 디렉토리 이동(rename) 후 머지는 충돌이 많다

패키지 경로 전체를 이동한 브랜치를 머지할 때, 같은 기간에 원래 경로에서
수정된 파일이 있으면 rename/delete 충돌이 대량 발생한다.
가능하면 리브랜딩 브랜치를 빨리 머지하거나, 머지 전에 master를 rebase할 것.

## 5. 리브랜딩 잔여 검색은 한 번에 철저하게

"완료"를 선언한 뒤 3회 이상 추가 잔여 참조가 발견됨.
초기 검색이 `.kt`/`.xml`만 대상으로 했고, 대소문자 구분 검색이었기 때문.

**교훈**: 리브랜딩 검증 시 반드시 **case-insensitive + 전 파일 타입** grep을 돌리고,
결과를 "변경 필요 / 의도적 유지 / 히스토리 문서"로 분류한 뒤 작업할 것.
파일 타입: `.kt`, `.xml`, `.gradle.kts`, `.properties`, `.md`, `.json`, `.pro`, `.html` 등 모두 포함.

## 6. macOS에서 `sed` alias 주의

일부 macOS 환경에서 `sed`가 `sd`(다른 도구)로 alias 되어 있어,
`find | xargs sed` 명령이 silent fail — 성공 코드를 반환하지만 실제로 파일이 변경되지 않음.

**교훈**: 대량 치환 시 `which sed`로 실제 바이너리 확인 or `/usr/bin/sed` 명시 사용.
가능하면 Edit 도구(정확한 문자열 매칭)를 우선 사용하고, sed는 최후의 수단으로만.

## 7. 디렉토리 rename 후 도구 캐시 무효화

디렉토리명을 변경하면 Edit 도구가 "File has not been read yet" 오류를 반환.
경로가 바뀌었기 때문에 이전에 읽은 캐시가 무효화됨.

**교훈**: 디렉토리 rename 후에는 대상 파일을 새 경로로 다시 Read한 뒤 Edit해야 한다.
