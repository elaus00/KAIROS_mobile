# Flit. 아키텍처 컨벤션 (Leakage 허용 기준)

> 작성일: 2026-02-07
> 목적: 클린 아키텍처를 실용적으로 운영하되, 무분별한 하이브리드 혼용을 방지한다.

## 1. 기본 원칙

- 기본 경로는 `Presentation -> UseCase -> Repository -> DataSource`를 따른다.
- 단순성과 개발 속도를 위해 의도적 leakage는 허용한다.
- leakage는 "예외"가 아니라 "명시적 규칙"으로 관리한다.

## 2. Leakage 허용 조건

아래를 모두 만족하면 ViewModel의 Repository 직접 의존을 허용한다.

1. 읽기 전용 조회다. (상태 변경/외부 부작용 없음)
2. 단일 Repository 호출 또는 얕은 조합 수준이다.
3. 트랜잭션/재시도/큐잉/동기화 정책이 개입되지 않는다.
4. 테스트 복잡도를 실질적으로 낮춘다.
5. 같은 도메인에서 UseCase 경로와 충돌하지 않는다.

## 3. 반드시 UseCase를 거쳐야 하는 경우

- 생성/수정/삭제/확정/이동 등 상태 변경
- 복수 Repository 조합
- 트랜잭션 경계 필요
- WorkManager/외부 API/동기화 큐 연동
- 도메인 규칙(검증, 정책, 상태 전이) 적용

## 4. 하이브리드 금지 규칙

- 같은 ViewModel 안에서 같은 도메인 동작을 `UseCase`와 `Repository`로 섞지 않는다.
- 이미 해당 동작 UseCase가 존재하면 Repository 직접 호출을 금지한다.
- 예외 허용 시 코드 주석으로 이유를 남기고, 후속 정리 이슈를 등록한다.

## 5. 실무 판단 체크리스트

- 이 로직이 2주 뒤 재사용될 가능성이 높은가?
- 정책이 바뀌면 수정 지점이 한 곳이어야 하는가?
- 단위 테스트가 UseCase 경유가 더 단순한가?
- 지금의 직접 의존이 팀 규칙을 약화시키는가?

위 항목 중 2개 이상 `Yes`면 UseCase로 승격한다.
